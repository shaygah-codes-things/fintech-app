# Correlation ID Walkthrough

This document demonstrates how correlation IDs are propagated end-to-end in the fintech app.  
Each log line is structured JSON emitted by the backend logger.

---

## 1. Frontend → Backend (create payout)

The frontend sends `POST /payouts` with:

Idempotency-Key: ikey-1726312345678
X-Correlation-ID: ui-1726312345678

Backend logs:

```
{"path": "http://localhost:8000/payouts", "method": "POST", "status": 200, "duration_ms": 706, "cid": "ui-1726312345678", "event": "request_completed", "level": "info", "timestamp": "2025-09-14T18:02:13.051Z"}
{"id": 68, "amount": "1200.50", "currency": "USD", "status": "processing", "cid": "ui-1726312345678", "event": "payout_created", "level": "info", "timestamp": "2025-09-14T18:02:13.050Z"}
```

The response includes:
X-Correlation-ID: ui-1726312345678

---

## 2. Backend → Mock provider

The backend forwards the correlation ID to the mock provider:

POST /provider/payouts
X-Correlation-ID: ui-1726312345678

Mock provider logs (same correlation ID):

```{"action": "provider_request_received", "amount": "1200.50", "currency": "USD", "cid": "ui-1726312345678", "event": "provider_request", "level": "info", "timestamp": "2025-09-14T18:02:12.362Z"}
{"payout_ref": "demo_ref_1", "status": "paid", "cid": "ui-1726312345678", "event": "provider_scheduled_webhook", "level": "info", "timestamp": "2025-09-14T18:02:12.370Z"}
```

---

## 3. Mock provider → Backend (webhook)

The mock provider later calls `POST /webhooks/payments` with:

X-Correlation-ID: ui-1726312345678
x-sig-ts: 1726312348
x-sig: <hmac>

Backend logs:

```{"event": "webhook_received", "payout_ref": "demo_ref_1", "status": "paid", "cid": "ui-1726312345678", "level": "info", "timestamp": "2025-09-14T18:02:18.402Z"}
{"id": 68, "from": "processing", "to": "paid", "cid": "ui-1726312345678", "event": "payout_status_updated", "level": "info", "timestamp": "2025-09-14T18:02:18.439Z"}
{"path": "http://localhost:8000/webhooks/payments", "method": "POST", "status": 200, "duration_ms": 39, "cid": "ui-1726312345678", "event": "request_completed", "level": "info", "timestamp": "2025-09-14T18:02:18.441Z"}
```

---

## Summary

- A single correlation ID (ui-1726312345678) was generated by the frontend.
- It flowed through backend logs, outbound provider call, and back into the webhook handler.
- This makes it easy to trace one payout request end-to-end across all components.
